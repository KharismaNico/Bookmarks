$Crabapple.TriforceModule_ent_m240=function(){};$Crabapple.extend($Crabapple.TriforceModule,$Crabapple.TriforceModule_ent_m240,{viewName:'$Crabapple.TriforceView_ent_m240',moduleName:'ENT_M240',ITEM_SELECTOR:'.item',NOW_PLAYING_CLASS:'active',FAKE_ITEM_CLASS:'item--fake',LEFT_FEED_FAKE_ITEM_CLASS:'item--left-feed-fake',RIGHT_FEED_FAKE_ITEM_CLASS:'item--right-feed-fake',LOADING_ITEM_CLASS:'item--loading',PLACEHOLDER_ITEM_CLASS:'item--placeholder',preventRefreshOnNextPageLoad:false,doRefresh:true,doMaxymiserOverride:true,doAdobeTargetOverride:true,$carousel:null,isAutoAdvanceInitialized:false,isReportingInitialized:false,isPageScrollInitialized:false,itemsIds:null,nowPlayingId:null,upNextId:null,leftSubFeeds:null,rightSubFeeds:null,isLoadingSubFeed:false,itemsFeeds:null,_onSelectItemsLoadTimeoutId:null,_onScrollCheckImagesTimeoutId:null,_isCheckImagesFrameRequested:false,_checkImagesTimeoutId:null,_checkImagesCounter:null,preventPageScrollToTop:false,isMaxRecommendsInitialized:false,_onMaxymiserOverride:null,isAdobeTargetRecommendsInitialized:false,_onAdobeTargetOverride:null,_onVideoSelected:null,_onVideoEnd:null,_onTriforceLoadPage:null,_onTriforcePageScrollToTop:null,autoAdvanceFired:false,activePlaylistName:false,$selectedCell:null,listTitleElLoaded:false,feedsData:null,CLASS_ACTIVE:'active',CLASS_LIST_COUNT:'list-count',CLASS_LIST_TITLE:'list-title',DATA_ATTR_PLAYLIST_NAME:'data-playlist-name',DATA_ATTR_FEEDTITLE:'data-feedtitle',FLKTY_CLASS_SELECTED_CELL:'is-selected',SELECTOR_PLAYLIST_HEADER:'.playlist-header',SELECTOR_PLAYLIST_HEADER_TEXT:'.playlist-text',SELECTOR_PLAYLIST_HEADER_COUNT:'.playlist-count',onModuleWillRefresh:function(){return true;},onModuleRefresh:function(feedData){if(this.doRefresh){this.refreshModule(feedData);}},onModuleDestroy:function(){this.feedsData=null;this.cancelSubFeeds();if(this._onSelectItemsLoadTimeoutId){clearTimeout(this._onSelectItemsLoadTimeoutId);this._onSelectItemsLoadTimeoutId=null;}
if(this._checkImagesTimeoutId){clearTimeout(this._checkImagesTimeoutId);this._checkImagesTimeoutId=null;}
if(this._onTriforceLoadPage){this.off('triforce:loadpage',this._onTriforceLoadPage);this._onTriforceLoadPage=null;}
if(this._onMaxymiserOverride){this.off('page:maxymiser:ENT_M240',this._onMaxymiserOverride);this._onMaxymiserOverride=null;}
if(this._onAdobeTargetOverride){this.off('page:AdobeTarget:ENT_M240',this._onAdobeTargetOverride);this._onAdobeTargetOverride=null;}
if(this._onVideoSelected){this.off('page:videoSelected',this._onVideoSelected);this._onVideoSelected=null;}
if(this._onVideoEnd){this.off('page:videoEnd',this._onVideoEnd);this._onVideoEnd=null;}
if(this._onTriforcePageScrollToTop){this.off('triforce:pageScrollToTop',this._onTriforcePageScrollToTop);this._onTriforcePageScrollToTop=null;}},refreshModule:function(feedData){this.feedResponse=feedData;this.initializeView();},postRender:function(){if(!this._onTriforceLoadPage){this._onTriforceLoadPage=this.onTriforceLoadPage.bind(this);this.on('triforce:loadpage',this._onTriforceLoadPage);}
this.itemsIds=[];this.feedsData={};var controller=this,$items=this.moduleElement.find('.item'),$itemsToRemove=$();$items.each(function(index,el){var id=el.getAttribute('data-id');if(id){controller.itemsIds.push(id);}else{$itemsToRemove=$itemsToRemove.add(el);}});$itemsToRemove.remove();this.initializeCarousel();this.initializeAutoAdvance();this.initializePageScroll();this.initializeMaxRecommends();this.initializeTargetRecommends();this.addModuleReporting();},addModuleReporting:function(){if(this.isReportingInitialized){return;}
this.delegateEvent('click','.flickity-prev-next-button.next',function(){this.reportClickThrough({moduleAction:'clicks on next button'});});this.delegateEvent('click','.flickity-prev-next-button.previous',function(){this.reportClickThrough({moduleAction:'clicks on previous button'});});this.isReportingInitialized=true;},initializePageScroll:function(){if(this.isPageScrollInitialized){return;}
this._onTriforcePageScrollToTop=this.onTriforcePageScrollToTop.bind(this);this.on('triforce:pageScrollToTop',this._onTriforcePageScrollToTop);this.isPageScrollInitialized=true;},onTriforcePageScrollToTop:function(event){if(this.preventPageScrollToTop){this.preventPageScrollToTop=false;event=event[0]&&event[0][1];if(event&&event.preventDefault!=='function'){event.preventDefault();}}},initializeMaxRecommends:function(){if(this.isMaxRecommendsInitialized){return;}
this._onMaxymiserOverride=this.onMaxymiserOverride.bind(this);this.on('page:maxymiser:ENT_M240',this._onMaxymiserOverride,true);this.isMaxRecommendsInitialized=true;},onMaxymiserOverride:function(event){if(this.doMaxymiserOverride){event=event[0];this.processMaxRecommendations(event&&event[1]);}},initializeTargetRecommends:function(){if(this.isAdobeTargetRecommendsInitialized){return;}
this._onAdobeTargetOverride=this.onAdobeTargetOverride.bind(this);this.on('page:AdobeTarget:ENT_M240',this._onAdobeTargetOverride,false);this.isAdobeTargetRecommendsInitialized=true;},onAdobeTargetOverride:function(event){if(this.doAdobeTargetOverride){event=event[0];console.log('event: '+JSON.stringify(event[1]));this.removeItems(this.$carousel.find('.item:not(".is-selected")'));this.onSubFeedLoaded(event&&event[1],true);this.cancelSubFeeds(true);var playlistHeaderEl=this.moduleElement.find(this.SELECTOR_PLAYLIST_HEADER);playlistHeaderEl.find(this.SELECTOR_PLAYLIST_HEADER_TEXT).empty();playlistHeaderEl.find(this.SELECTOR_PLAYLIST_HEADER_COUNT).empty();}},processMaxRecommendations:function(recommendations){this.removeItems(this.$carousel.find('.item:not([data-primary]):not(.'+this.FAKE_ITEM_CLASS+')'));if(recommendations){this.rightSubFeeds=this.rightSubFeeds||[];this.rightSubFeeds.push({isMaxRecommends:true,response:recommendations});}
this.cancelSubFeeds(true);},onTriforceLoadPage:function(){this.autoAdvanceFired=false;this.doRefresh=this.doMaxymiserOverride=!this.preventRefreshOnNextPageLoad;if(this.preventRefreshOnNextPageLoad){this.preventRefreshOnNextPageLoad=false;}else{this.nowPlayingId=null;this.upNextId=null;this.cancelSubFeeds();}},onNextItemSelected:function($nextItem,moduleAction){var $link=$nextItem.find('> a'),upNextURL=$link.length&&$link[0].href;if(!upNextURL){return;}
this.nowPlayingId=$nextItem.attr('data-id');this.updateNowPlayingEl($nextItem);this.updateActivePlaylistEl($nextItem);this.preventPageScrollToTop=true;$('html, body').animate({scrollTop:0},500);this.preventRefreshOnNextPageLoad=true;this.trigger('triforce:loadpage',upNextURL);this.reportClickThrough({destination:upNextURL,moduleAction:moduleAction});},initializeCarousel:function(){var controller=this;this.$carousel=this.moduleElement.find('.items-wrap').flickity({cellSelector:this.ITEM_SELECTOR,contain:true,draggable:true,percentPosition:false,pageDots:false,freeScroll:true,cellAlign:'left'}).on('select.flickity',function(){controller.updateCarouselButtonsState();controller.checkItemsToLoad();}).on('scroll.flickity',function(){controller.checkImagesToLoad();controller.updateActivePlaylist();}).on('click','a',function(e){e.preventDefault();}).on('staticClick.flickity',function(e,pointer,cellElement){var $cellElement=$(cellElement);if(!$cellElement.hasClass(controller.NOW_PLAYING_CLASS)&&controller.isItemLoaded($cellElement)){controller.onNextItemSelected($cellElement,'clicks on thumbnail');}});var flkty=this.$carousel.data('flickity');flkty.next=function(){var index=controller.getCarouselNextIndex();if(index!==undefined){this.select(index);}};flkty.previous=function(){var index=controller.getCarouselPreviousIndex();if(index!==undefined){this.select(index);}};this.initializeCarouselSubFeeds();},getCarouselNextIndex:function(){var flkty=this.$carousel.data('flickity');if(flkty.slides.length&&flkty.selectedIndex!==flkty.slides.length-1){var selectIndex=flkty.slides.length-1,target=flkty.selectedSlide.target+flkty.size.innerWidth,prevOffset,i,len;for(i=flkty.selectedIndex+1,len=flkty.slides.length;i<len;i++){var slide=flkty.slides[i],offset=target-(slide.target+slide.outerWidth);if(offset<0){if(!prevOffset||offset>=prevOffset){prevOffset=offset;selectIndex=i;}else{break;}}}
return selectIndex;}},getCarouselPreviousIndex:function(){var flkty=this.$carousel.data('flickity');if(flkty.slides.length&&flkty.selectedIndex!==0){var selectIndex=0,target,prevOffset,i;for(i=flkty.selectedIndex-1;i>=0;i--){var slide=flkty.slides[i];if(target===undefined){if(slide.target<flkty.selectedSlide.target){target=slide.target+slide.outerWidth-flkty.size.innerWidth;selectIndex=i;}}else{var offset=target-slide.target;if(offset<0){if(!prevOffset||offset>=prevOffset){prevOffset=offset;selectIndex=i;}else{break;}}}}
return selectIndex;}},updateCarouselButtonsState:function(){var flkty=this.$carousel.data('flickity');if(flkty.nextButton){this.updateCarouselButtonState(flkty.nextButton);}
if(flkty.prevButton){this.updateCarouselButtonState(flkty.prevButton);}},updateCarouselButtonState:function(button){if(!button||!button.element){return;}
button.element.disabled=false;if(button.isEnabled){button.element.classList.remove('disabled');}else{button.element.classList.add('disabled');}},initializeCarouselSubFeeds:function(){var settings=this.feedResponse.result.settings;if(settings&&settings.subFeeds&&settings.subFeeds.length){this.processSubFeeds(settings.subFeeds);this.checkSubFeedsFakeItems();}},cancelSubFeeds:function(doNotCancelPrimary){this.leftSubFeeds=this.filterSubFeedsAndCancel(this.leftSubFeeds,doNotCancelPrimary);this.rightSubFeeds=this.filterSubFeedsAndCancel(this.rightSubFeeds,doNotCancelPrimary);this.itemsFeeds=this.filterSubFeedsAndCancel(this.itemsFeeds,doNotCancelPrimary);this.checkSubFeedsFakeItems();},filterSubFeedsAndCancel:function(subFeeds,doNotCancelPrimary){var toCancel=[],toLeave=[];if(subFeeds&&subFeeds.length){if(doNotCancelPrimary){subFeeds.forEach(function(subFeed){if(subFeed.isPrimary||subFeed.isMaxRecommends){toLeave.push(subFeed);}else{toCancel.push(subFeed);}});}else{toCancel=subFeeds;}
if(toCancel.length){toCancel.forEach(function(feed){if(feed&&feed.request&&typeof feed.request.abort==='function'){feed.request.abort();}});}}
return toLeave;},processSubFeeds:function(subFeeds,options){if(subFeeds&&subFeeds.length){var leftSubFeeds=[],rightSubFeeds=[],foundPrimarySubFeed=false;subFeeds.forEach(function(subFeed){if(!foundPrimarySubFeed){if(options&&options.parentId){subFeed.isPrimary=subFeed.url.indexOf(options.parentId)>=0;}
if(subFeed.isPrimary){foundPrimarySubFeed=true;if(rightSubFeeds.length){leftSubFeeds=rightSubFeeds;rightSubFeeds=[];}}}
rightSubFeeds.push(subFeed);});if(leftSubFeeds.length){this.leftSubFeeds=this.leftSubFeeds?this.leftSubFeeds.concat(leftSubFeeds):leftSubFeeds;}
if(rightSubFeeds.length){this.rightSubFeeds=this.rightSubFeeds?rightSubFeeds.concat(this.rightSubFeeds):rightSubFeeds;}}},checkSubFeedsFakeItems:function(){var NUMBER_OF_FAKE_ITEMS=10,hasLeftSubFeeds=this.leftSubFeeds&&this.leftSubFeeds.length,hasRightSubFeeds=this.rightSubFeeds&&this.rightSubFeeds.length;if(hasLeftSubFeeds){if(!this.leftSubFeedFakeItemsRendered){this.insertItems(this.renderFakeItems(NUMBER_OF_FAKE_ITEMS,this.LEFT_FEED_FAKE_ITEM_CLASS),0,false);this.leftSubFeedFakeItemsRendered=true;}}else{if(this.leftSubFeedFakeItemsRendered){this.removeItems(this.$carousel.find('.'+this.LEFT_FEED_FAKE_ITEM_CLASS));this.leftSubFeedFakeItemsRendered=false;}}
if(hasRightSubFeeds){if(!this.rightSubFeedFakeItemsRendered){this.insertItems(this.renderFakeItems(NUMBER_OF_FAKE_ITEMS,this.RIGHT_FEED_FAKE_ITEM_CLASS),this.$carousel.data('flickity').cells.length,true);this.rightSubFeedFakeItemsRendered=true;}}else{if(this.rightSubFeedFakeItemsRendered){this.removeItems(this.$carousel.find('.'+this.RIGHT_FEED_FAKE_ITEM_CLASS));this.rightSubFeedFakeItemsRendered=false;}}},loadSubFeed:function(isRightSubFeed){if(this.isLoadingSubFeed){return;}
var controller=this,subFeed;if(isRightSubFeed){if(this.rightSubFeeds&&this.rightSubFeeds.length){subFeed=this.rightSubFeeds[0];}}else{if(this.leftSubFeeds&&this.leftSubFeeds.length){subFeed=this.leftSubFeeds[this.leftSubFeeds.length-1];}}
if(!subFeed){return;}
this.isLoadingSubFeed=true;if(subFeed.isMaxRecommends){this.onSubFeedLoaded(subFeed,isRightSubFeed);}else{subFeed.request=$.getJSON(subFeed.url).always(function(response){subFeed.response=response;controller.onSubFeedLoaded(subFeed,isRightSubFeed);});}},onSubFeedLoaded:function(subFeed,isRightSubFeed){var response=subFeed.response;this.isLoadingSubFeed=false;if(isRightSubFeed){if(this.rightSubFeeds){this.rightSubFeeds.splice(0,1);}}else{if(this.leftSubFeeds){this.leftSubFeeds.splice(this.leftSubFeeds.length-1);}}
if(response&&response.result&&response.result.settings&&response.result.settings.subFeeds){this.processSubFeeds(response.result.settings.subFeeds,{isPrimary:subFeed.isPrimary,parentId:subFeed.parentId});}
this.checkSubFeedsFakeItems();if(!response){return;}
var renderedItems=this.renderFeedItems(response,{isPrimary:subFeed.isPrimary,isMaxRecommends:subFeed.isMaxRecommends}),insertIndex;if(renderedItems&&renderedItems.length){if(isRightSubFeed){var rightFakeIndex=this.$carousel.find('.'+this.RIGHT_FEED_FAKE_ITEM_CLASS+':first').index();if(rightFakeIndex!==-1){insertIndex=rightFakeIndex;}else{insertIndex=this.$carousel.data('flickity').cells.length;}}else{var leftFakeIndex=this.$carousel.find('.'+this.LEFT_FEED_FAKE_ITEM_CLASS+':last').index();if(leftFakeIndex!==-1){insertIndex=leftFakeIndex+1;}else{insertIndex=0;}}
this.insertItems(renderedItems,insertIndex,isRightSubFeed);}
this.checkItemsToLoad();},renderFeedItems:function(feed,options){if(!feed||!feed.result||!feed.result.data){return;}
var feedData=feed.result.data,items=feedData&&feedData.items&&this.filterItemsToRender(feedData.items);if(items&&items.length){var fragment=document.createDocumentFragment();this.view.renderTemplateTo(this.view.itemTemplateName,$(fragment),items);if(feedData.parentId||options&&(options.isPrimary||options.isMaxRecommends)){Array.prototype.forEach.call(fragment.childNodes,function(el){if(feedData.parentId){el.setAttribute('data-parentid',feedData.parentId);}
if(options){if(options.isPrimary){el.setAttribute('data-primary','true');}
if(options.isMaxRecommends){el.setAttribute('data-maxrecommends','true');}}});}
if(feedData.title){var controller=this,feedName=feedData.title.split(' ').join('_').toLowerCase();if(feedData.countText){this.feedsData[feedName]={countSuffixSingular:feedData.countSuffixSingular,countSuffixPlural:feedData.countSuffixPlural,countText:feedData.countText,itemsCount:fragment.childNodes.length};}
Array.prototype.forEach.call(fragment.childNodes,function(el){el.setAttribute(controller.DATA_ATTR_PLAYLIST_NAME,feedName);});fragment.childNodes[0].setAttribute('data-feedtitle',feedData.title);$(fragment.childNodes[0]).prepend(this.buildTitleEl(feedData.title,this.getPlaylistCountText(feedName)));}
if(fragment.childNodes.length===1){fragment.childNodes[0].classList.add('item--single');}
return fragment.childNodes;}},getPlaylistCountText:function(feedName){var feedData=this.feedsData[feedName],countTextSuffix;if(this.feedsData[feedName]){countTextSuffix=feedData.itemsCount===1?feedData.countSuffixSingular:feedData.countSuffixPlural;return feedData.countText.replace('{COUNT}',feedData.itemsCount).replace('{SUFFIX}',countTextSuffix)}},renderFakeItems:function(number,className){if(number){var FAKE_ITEM_DATA={isFake:true},fakeItems=[],fragment,i;for(i=0;i<number;i++){fakeItems.push(FAKE_ITEM_DATA);}
fragment=document.createDocumentFragment();this.view.renderTemplateTo(this.view.itemTemplateName,$(fragment),fakeItems);if(className){$(fragment.childNodes).addClass(className);}
return fragment.childNodes;}},filterItemsToRender:function(items){var controller=this;return items&&items.filter(function(item){return!item.isFake&&item.id&&controller.itemsIds.indexOf(item.id)===-1;});},checkItemsToLoad:function(){var controller=this;if(this._onSelectItemsLoadTimeoutId){clearTimeout(this._onSelectItemsLoadTimeoutId);}
this._onSelectItemsLoadTimeoutId=setTimeout(function(){controller._onSelectItemsLoadTimeoutId=null;var flkty=controller.$carousel.data('flickity'),$elementsToLoad=controller.getCarouselItemsToLoad();if($elementsToLoad.hasClass(controller.RIGHT_FEED_FAKE_ITEM_CLASS)){controller.loadSubFeed(true);}
if($elementsToLoad.hasClass(controller.LEFT_FEED_FAKE_ITEM_CLASS)){controller.loadSubFeed(false);}
$elementsToLoad.filter('.'+controller.PLACEHOLDER_ITEM_CLASS+':not(.'+controller.LOADING_ITEM_CLASS+')').each(function(index,el){var $el=$(el),id=$el.attr('data-id'),isPrimary=$el.attr('data-primary')==='true',feedURL=controller.getItemFeedURL({itemId:id,parentId:$el.attr('data-parentid')});if(feedURL){controller.itemsFeeds=controller.itemsFeeds||[];controller.itemsFeeds.push({isPrimary:isPrimary,request:$.getJSON(feedURL).always(function(response,status){if(status==='abort'){return;}
var removeEl=true,feedTitle=$el.attr('data-feedtitle'),isSingle=$el.hasClass('item--single'),isMaxRecommends=$el.attr('data-maxrecommends')==='true',playlistName=$el.attr(controller.DATA_ATTR_PLAYLIST_NAME);if(status==='success'&&response&&response.result&&response.result.data&&response.result.data.item){var fragment=document.createDocumentFragment(),newEl;controller.view.renderTemplateTo(controller.view.itemTemplateName,$(fragment),response.result.data.item);if(fragment.childNodes.length){newEl=fragment.childNodes[0];if(feedTitle){newEl.setAttribute('data-feedtitle',feedTitle);$(newEl).prepend(controller.buildTitleEl(feedTitle,controller.getPlaylistCountText(playlistName)));}
if(playlistName){newEl.setAttribute(controller.DATA_ATTR_PLAYLIST_NAME,playlistName);}
if(isPrimary){newEl.setAttribute('data-primary','true');}
if(isMaxRecommends){newEl.setAttribute('data-maxrecommends','true');}
if(isSingle){newEl.classList.add('item--single');}
$el.replaceWith(newEl);flkty.reloadCells();if(controller.nowPlayingId&&id===controller.nowPlayingId){controller.updateNowPlayingEl($(newEl));}else if(controller.upNextId&&id===controller.upNextId){controller.onUpNextLoaded();}
removeEl=false;}}
if(removeEl){controller.removeItems($el);}
controller.checkImagesToLoad();})});$el.addClass(controller.LOADING_ITEM_CLASS);}else{controller.removeItems($el);controller.checkImagesToLoad();}});},200);},getCarouselItemsToLoad:function(){var flkty=this.$carousel.data('flickity');if(flkty.slides.length){var elementsToLoad=[],cur,slide;cur=flkty.selectedIndex;slide=flkty.slides[cur];while(slide&&slide.target-flkty.selectedSlide.target<=2*flkty.size.innerWidth){elementsToLoad=elementsToLoad.concat(slide.getCellElements());slide=flkty.slides[++cur];}
if(flkty.selectedIndex!==0){cur=flkty.selectedIndex-1;slide=flkty.slides[cur];while(slide&&-1*(slide.target-flkty.selectedSlide.target)<=(flkty.slides.length/2)*flkty.size.innerWidth){elementsToLoad=elementsToLoad.concat(slide.getCellElements());slide=flkty.slides[--cur];}}
return $(elementsToLoad);}},insertItems:function(items,index,isRight){if(items&&items.length){var controller=this,flkty=this.$carousel.data('flickity'),hasNowPlayingItem=false,selectIndex=flkty.selectedIndex,offset=0;if(flkty.selectedSlide){offset=-1*flkty.x-flkty.selectedSlide.target;}
if(isRight){if(flkty.selectedIndex>index){selectIndex=flkty.selectedIndex+(index-flkty.selectedIndex);}}else{selectIndex=flkty.selectedIndex+items.length;}
Array.prototype.forEach.call(items,function(el){var id=el.getAttribute('data-id');if(id){controller.itemsIds.push(id);if(!hasNowPlayingItem&&controller.nowPlayingId&&controller.nowPlayingId===id){hasNowPlayingItem=true;}}});flkty.insert(items,index);if(hasNowPlayingItem){this.updateNowPlayingEl();}else{if(!this.upNextId){this.determineUpNext();}
flkty.select(Math.min(flkty.slides.length-1,selectIndex),false,true);if(offset!==0){flkty.x=-1*flkty.selectedSlide.target-offset;flkty.positionSlider();}}}},removeItems:function($items){if($items&&$items.length){var controller=this,flkty=this.$carousel.data('flickity'),hasUpNext=false,selectIndex=flkty.selectedIndex,firstItemIndex=$items.first().index(),offset=0;if(flkty.selectedSlide){offset=-1*flkty.x-flkty.selectedSlide.target;}
if(firstItemIndex<flkty.selectedIndex){if($items.last().index()<flkty.selectedIndex){selectIndex=flkty.selectedIndex-$items.length;}else{selectIndex=firstItemIndex;}}
$items.each(function(index,el){var id=el.getAttribute('data-id'),itemIndex;if(id){itemIndex=controller.itemsIds.indexOf(id);if(itemIndex!==-1){controller.itemsIds.splice(itemIndex,1);}
if(!hasUpNext&&controller.upNextId&&id===controller.upNextId){hasUpNext=true;}
var playlistName=el.getAttribute(controller.DATA_ATTR_PLAYLIST_NAME);if(playlistName){var feedData=controller.feedsData[playlistName];if(feedData){feedData.itemsCount--;if(feedData.itemsCount){var feedTitle=el.getAttribute('data-feedtitle'),$playlistTitleHolderEl;if(feedTitle){var $nextEl=$(el).next();if($nextEl.attr(controller.DATA_ATTR_PLAYLIST_NAME)===playlistName){$playlistTitleHolderEl=$nextEl;$playlistTitleHolderEl.attr('data-feedtitle',feedTitle);}}
if(!$playlistTitleHolderEl){$playlistTitleHolderEl=controller.moduleElement.find('['+controller.DATA_ATTR_PLAYLIST_NAME+'='+playlistName+']['+controller.DATA_ATTR_FEEDTITLE+']');}
if($playlistTitleHolderEl){$playlistTitleHolderEl.find('.'+this.CLASS_LIST_TITLE).remove();$playlistTitleHolderEl.prepend(controller.buildTitleEl(feedTitle,controller.getPlaylistCountText(playlistName)));if(feedData.itemsCount===1){$playlistTitleHolderEl.addClass('item--single');}}}}}}});flkty.remove($items);flkty.select(Math.max(0,selectIndex),false,true);if(offset!==0){flkty.x=-1*flkty.selectedSlide.target-offset;flkty.positionSlider();}
if(hasUpNext){this.determineUpNext();}}},selectItem:function(index){if(this.$carousel){this.$carousel.flickity('selectCell',index);}},checkImagesToLoad:function(){var controller=this;if(this._checkImagesTimeoutId){clearTimeout(this._checkImagesTimeoutId);this._checkImagesTimeoutId=null;}
if(this._checkImagesCounter===10){this._checkImagesCounter=0;this.requestCheckImagesToLoad();}else{this._checkImagesCounter++;this._checkImagesTimeoutId=setTimeout(function(){controller._checkImagesTimeoutId=null;controller._checkImagesCounter=0;controller.requestCheckImagesToLoad();},200);}},requestCheckImagesToLoad:function(){if(this._isCheckImagesFrameRequested){return;}
var controller=this;requestAnimationFrame(function(){controller._isCheckImagesFrameRequested=false;controller.trigger('triforce:pageintouch');});this._isCheckImagesFrameRequested=true;},initializeAutoAdvance:function(){if(this.isAutoAdvanceInitialized){return;}
this._onVideoSelected=this.onVideoSelected.bind(this);this.on('page:videoSelected',this._onVideoSelected,true);this._onVideoEnd=this.onVideoEnd.bind(this);this.on('page:videoEnd',this._onVideoEnd,true);this.isAutoAdvanceInitialized=true;},onVideoSelected:function(event){event=event[0];if(!event||!event[1]||!event[1].uri){return;}
var id=event[1].uri.split(':')[4];if(id){this.nowPlayingId=id;this.updateNowPlayingEl();this.updateActivePlaylistEl();}},onVideoEnd:function(){this.autoAdvance();},onUpNextLoaded:function(){if(this.autoAdvanceFired){this.autoAdvance();}},autoAdvance:function(){this.autoAdvanceFired=true;var $upNextEl=this.getUpNextEl();if(this.isItemLoaded($upNextEl)){this.autoAdvanceFired=false;this.onNextItemSelected($upNextEl,'video autoplayed');}},updateNowPlayingEl:function($el){$el=$el&&$el.length?$el:this.getNowPlayingEl();if($el&&$el.length&&!$el.hasClass(this.NOW_PLAYING_CLASS)){$el.addClass(this.NOW_PLAYING_CLASS).siblings().removeClass(this.NOW_PLAYING_CLASS);this.selectItem($el.index());}
this.updateActivePlaylist();this.determineUpNext();},determineUpNext:function(){var $nowPlayingEl=this.getNowPlayingEl(),$upNextEl,upNextId;if($nowPlayingEl&&$nowPlayingEl.length){$upNextEl=$nowPlayingEl.next();}else{$upNextEl=this.$carousel.find(this.ITEM_SELECTOR+'[data-id]:first');}
if($upNextEl.length){upNextId=$upNextEl.attr('data-id');if(upNextId&&upNextId!==this.upNextId){this.upNextId=upNextId;if(this.isItemLoaded($upNextEl)){this.onUpNextLoaded();}}}else if(this.upNextId){this.upNextId=null;}},isItemLoaded:function($el){return $el&&$el.length?!$el.hasClass(this.PLACEHOLDER_ITEM_CLASS)&&!$el.hasClass(this.FAKE_ITEM_CLASS):false;},getNowPlayingEl:function(){if(!this.nowPlayingId){return;}
return this.moduleElement.find(this.ITEM_SELECTOR+'[data-id="'+this.nowPlayingId+'"]');},getUpNextEl:function(){if(!this.upNextId){return;}
return this.moduleElement.find(this.ITEM_SELECTOR+'[data-id="'+this.upNextId+'"]');},getItemFeedURL:function(parameters){if(!parameters||!parameters.itemId){return;}
var settings=this.feedResponse.result.settings,itemFeedURL=settings&&settings.itemFeedURL;if(!itemFeedURL){return;}
itemFeedURL=itemFeedURL.replace('{itemId}',parameters.itemId);if(parameters.parentId){itemFeedURL=itemFeedURL.replace('{parentId}',parameters.parentId);}else{itemFeedURL=itemFeedURL.replace('/{parentId}','');}
return itemFeedURL;},buildTitleEl:function(title,countText){var listTitleContainerEl=document.createElement('div'),listTitleCountEl=document.createElement('span');listTitleContainerEl.setAttribute('class',this.CLASS_LIST_TITLE);listTitleCountEl.setAttribute('class',this.CLASS_LIST_COUNT);listTitleContainerEl.textContent=title;listTitleCountEl.textContent=countText;listTitleContainerEl.appendChild(listTitleCountEl);return listTitleContainerEl;},getActivePlaylistEl:function(){if(!this.activePlaylistName){this.resetActivePlaylist();return;}
var el=this.moduleElement.find(this.ITEM_SELECTOR+'['+this.DATA_ATTR_PLAYLIST_NAME+'="'+this.activePlaylistName+'"]');return $(el).find('.'+this.CLASS_LIST_TITLE);},getListTitleEl:function(){if(this.activePlaylistName){return this.$carousel.find(this.ITEM_SELECTOR+'['+this.DATA_ATTR_PLAYLIST_NAME+'="'+this.activePlaylistName+'"] .'+this.CLASS_LIST_TITLE+'');}},getSelectedCell:function(){if(this.$carousel){return this.$carousel.find(this.ITEM_SELECTOR+'.'+this.FLKTY_CLASS_SELECTED_CELL);}},getSelectedCellOuterWidth:function(item){if(!item){return;}
return $(item).outerWidth();},getSelectedCellPadding:function(item){if(!item){return;}
return parseInt($(item).css('padding-left'))+parseInt($(item).css('padding-right'))+5;},setActivePlaylistName:function(item){if(!item){return;}
var playlistName=$(item).attr(this.DATA_ATTR_PLAYLIST_NAME);this.activePlaylistName=playlistName?playlistName:false;},determinePlaylistName:function(item){if(!item){return false;}
this.setActivePlaylistName(item);},updateActivePlaylistEl:function(item){if(!this.$carousel||!this.moduleElement){return;}
item=item&&item.length?item:this.getActivePlaylistEl();if(item&&item.length&&!item.hasClass(this.CLASS_ACTIVE)){this.moduleElement.find(this.SELECTOR_PLAYLIST_HEADER).addClass(this.CLASS_ACTIVE);this.$carousel.find('.'+this.CLASS_LIST_TITLE).removeClass(this.CLASS_ACTIVE);item.addClass(this.CLASS_ACTIVE);}},resetActivePlaylist:function(){if(this.moduleElement){var playlistHeaderEl=this.moduleElement.find(this.SELECTOR_PLAYLIST_HEADER);playlistHeaderEl.find(this.SELECTOR_PLAYLIST_HEADER_TEXT).empty();playlistHeaderEl.find(this.SELECTOR_PLAYLIST_HEADER_COUNT).empty();playlistHeaderEl.removeClass(this.CLASS_ACTIVE);this.$carousel.find('.'+this.CLASS_LIST_TITLE).show();}},resizePlaylistHeaderEl:function($el,width){if(!$el){return;}
$el.css({'width':width});},stickActivePlaylist:function(item){if(!this.activePlaylistName){this.resetActivePlaylist();return;}
var controller=this,itemOuterWidth=this.getSelectedCellOuterWidth(item),itemPadding=this.getSelectedCellPadding(item),playlist=this.$carousel.find(this.ITEM_SELECTOR+'['+this.DATA_ATTR_PLAYLIST_NAME+'="'+this.activePlaylistName+'"]'),playlistOffsetFirst=$(playlist).first().offset().left-itemPadding,playlistOffsetLast=$(playlist).last().offset().left+itemOuterWidth,playlistHeaderEl=this.moduleElement.find(this.SELECTOR_PLAYLIST_HEADER),playlistHeaderTextEl=playlistHeaderEl.find(this.SELECTOR_PLAYLIST_HEADER_TEXT),playlistHeaderCountTextEl=playlistHeaderEl.find(this.SELECTOR_PLAYLIST_HEADER_COUNT),windowOuterWidth=$(window).outerWidth(),windowWidth=$(window).width()-itemPadding,playlistText,playlistCountText,checkListTitleElExist,listTitleEl;if(playlistOffsetFirst<=0){if(!this.listTitleElLoaded){checkListTitleElExist=setInterval(function(){listTitleEl=controller.getListTitleEl();if(listTitleEl&&listTitleEl.length){playlistCountText=listTitleEl.find('.'+controller.CLASS_LIST_COUNT).text();playlistText=listTitleEl.clone().children().remove().end().text();playlistHeaderTextEl.text(playlistText);playlistHeaderCountTextEl.text(playlistCountText);playlistHeaderEl.addClass(controller.CLASS_ACTIVE);controller.$carousel.find('.'+controller.CLASS_LIST_TITLE).show();listTitleEl.hide();if(listTitleEl.outerWidth()>windowOuterWidth){if((windowWidth-itemPadding)>=playlistOffsetLast){if(playlistOffsetLast-itemPadding>0){controller.resizePlaylistHeaderEl(playlistHeaderEl,playlistOffsetLast-itemPadding);}}else{controller.resizePlaylistHeaderEl(playlistHeaderEl,windowWidth-itemPadding);}}
controller.listTitleElLoaded=true;clearInterval(checkListTitleElExist);}},200);}else{listTitleEl=controller.getListTitleEl();if(listTitleEl&&listTitleEl.length){playlistCountText=listTitleEl.find('.'+controller.CLASS_LIST_COUNT).text();playlistText=listTitleEl.clone().children().remove().end().text();playlistHeaderTextEl.text(playlistText);playlistHeaderCountTextEl.text(playlistCountText);playlistHeaderEl.addClass(controller.CLASS_ACTIVE);controller.$carousel.find('.'+controller.CLASS_LIST_TITLE).show();listTitleEl.hide();if(listTitleEl.outerWidth()>windowOuterWidth){if((windowWidth-itemPadding)>playlistOffsetLast){this.resizePlaylistHeaderEl(playlistHeaderEl,playlistOffsetLast-itemPadding);}else{this.resizePlaylistHeaderEl(playlistHeaderEl,windowWidth-itemPadding);}}else{if((windowWidth-itemPadding)>=playlistOffsetLast){if(playlistOffsetLast-itemPadding>0){this.resizePlaylistHeaderEl(playlistHeaderEl,playlistOffsetLast-itemPadding);}}else{this.resizePlaylistHeaderEl(playlistHeaderEl,windowWidth-itemPadding);}}}}}else{playlistHeaderTextEl.empty();playlistHeaderCountTextEl.empty();playlistHeaderEl.removeClass(this.CLASS_ACTIVE);$(playlist).find('.'+this.CLASS_LIST_TITLE).show();}},updateActivePlaylist:function(){var selectedCell;selectedCell=this.getSelectedCell();if(selectedCell&&selectedCell.length>0){this.determinePlaylistName(selectedCell);}
this.stickActivePlaylist(selectedCell);}});$Crabapple.TriforceView_ent_m240={'parentView':'$Crabapple.TriforceMustacheView','extention':{templateName:'Modules/ENT_M240/V2_0_0/Controller/default',itemTemplateName:'Modules/ENT_M240/V2_0_0/Controller/item'}};(function(name){this.$Crabapple=this.$Crabapple||{};this.$Crabapple.TriforceTemplates=this.$Crabapple.TriforceTemplates||{};this.$Crabapple.TriforceTemplates[name]=this.$Crabapple.TriforceTemplates[name]||new Hogan.Template({code:function(c,p,i){var t=this;t.b(i=i||"");if(t.s(t.f("data",c,p,1),c,p,0,9,398,"{{ }}")){t.rs(c,p,function(c,p,t){t.b("<div class=\"container\"><div class=\"module-container\">");if(t.s(t.f("header",c,p,1),c,p,0,73,138,"{{ }}")){t.rs(c,p,function(c,p,t){t.b("<header class=\"header-md\"><div class=\"label\">");t.b(t.v(t.d(".",c,p,0)));t.b("</div></header>");});c.pop();}t.b("<div class=\"playlist-header\"><span class=\"playlist-text\"></span><span class=\"playlist-count\"></span></div><div class=\"items-container\"><div class=\"items-wrap\">");if(t.s(t.f("items",c,p,1),c,p,0,318,364,"{{ }}")){t.rs(c,p,function(c,p,t){t.b(t.rp("<Modules/ENT_M240/V2_0_0/Controller/item0",c,p,""));});c.pop();}t.b("</div></div></div></div>");});c.pop();}return t.fl();},partials:{"<Modules/ENT_M240/V2_0_0/Controller/item0":{name:"Modules/ENT_M240/V2_0_0/Controller/item",partials:{},subs:{}}},subs:{}});}).call(this,"Modules/ENT_M240/V2_0_0/Controller/default");(function(name){this.$Crabapple=this.$Crabapple||{};this.$Crabapple.TriforceTemplates=this.$Crabapple.TriforceTemplates||{};this.$Crabapple.TriforceTemplates[name]=this.$Crabapple.TriforceTemplates[name]||new Hogan.Template({code:function(c,p,i){var t=this;t.b(i=i||"");t.b("<div class=\"item");if(t.s(t.d("tveAuth.mobile",c,p,1),c,p,0,35,49,"{{ }}")){t.rs(c,p,function(c,p,t){t.b(" locked-mobile");});c.pop();}if(t.s(t.d("tveAuth.desktop",c,p,1),c,p,0,88,103,"{{ }}")){t.rs(c,p,function(c,p,t){t.b(" locked-desktop");});c.pop();}if(t.s(t.f("isPlaceholder",c,p,1),c,p,0,141,159,"{{ }}")){t.rs(c,p,function(c,p,t){t.b(" item--placeholder");});c.pop();}if(t.s(t.f("isFake",c,p,1),c,p,0,188,199,"{{ }}")){t.rs(c,p,function(c,p,t){t.b(" item--fake");});c.pop();}t.b("\"");if(t.s(t.f("id",c,p,1),c,p,0,218,234,"{{ }}")){t.rs(c,p,function(c,p,t){t.b(" data-id=\"");t.b(t.v(t.d(".",c,p,0)));t.b("\"");});c.pop();}t.b(">");if(t.s(t.f("url",c,p,1),c,p,0,250,285,"{{ }}")){t.rs(c,p,function(c,p,t){t.b("<a href=\"");t.b(t.v(t.d(".",c,p,0)));t.b("\" class=\"notriforce\">");});c.pop();}t.b("<div class=\"media-wrap\"><div class=\"media\"><div class=\"item-container containerx16x9\">");t.b(t.rp("<common/image0",c,p,""));t.b("</div></div>");if(t.s(t.f("badge",c,p,1),c,p,0,472,533,"{{ }}")){t.rs(c,p,function(c,p,t){t.b("<div class=\"badge");if(t.s(t.d(".type",c,p,1),c,p,0,499,505,"{{ }}")){t.rs(c,p,function(c,p,t){t.b(" ");t.b(t.v(t.d(".",c,p,0)));});c.pop();}t.b("\">");t.b(t.v(t.d(".title",c,p,0)));t.b("</div>");});c.pop();}if(t.s(t.f("duration",c,p,1),c,p,0,556,590,"{{ }}")){t.rs(c,p,function(c,p,t){t.b("<div class=\"timestamp\">");t.b(t.v(t.d(".",c,p,0)));t.b("</div>");});c.pop();}t.b("</div><div class=\"meta-wrap\"><div class=\"header\">");if(t.s(t.f("parentTitle",c,p,1),c,p,0,668,684,"{{ }}")){t.rs(c,p,function(c,p,t){t.b("<div>");t.b(t.v(t.d(".",c,p,0)));t.b("</div>");});c.pop();}if(t.s(t.f("meta",c,p,1),c,p,0,709,727,"{{ }}")){t.rs(c,p,function(c,p,t){t.b("<span>");t.b(t.v(t.d(".",c,p,0)));t.b("</span>");});c.pop();}t.b("</div>");if(t.s(t.f("title",c,p,1),c,p,0,752,796,"{{ }}")){t.rs(c,p,function(c,p,t){t.b("<div class=\"sub-header\"><h4>");t.b(t.v(t.d(".",c,p,0)));t.b("</h4></div>");});c.pop();}if(t.s(t.f("description",c,p,1),c,p,0,822,858,"{{ }}")){t.rs(c,p,function(c,p,t){t.b("<div class=\"deck\"><p>");t.b(t.v(t.d(".",c,p,0)));t.b("</p></div>");});c.pop();}t.b("</div>");if(t.s(t.f("url",c,p,1),c,p,0,888,892,"{{ }}")){t.rs(c,p,function(c,p,t){t.b("</a>");});c.pop();}t.b("</div>");return t.fl();},partials:{"<common/image0":{name:"common/image",partials:{},subs:{"imageClass":function(c,p,t,i){t.b("content");}}}},subs:{}});}).call(this,"Modules/ENT_M240/V2_0_0/Controller/item");