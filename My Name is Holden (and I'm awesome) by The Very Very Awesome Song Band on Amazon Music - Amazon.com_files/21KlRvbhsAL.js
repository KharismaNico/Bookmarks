(function(e){var d=window.AmazonUIPageJS||window.P,l=d._namespace||d.attributeErrors,c=l?l("DigitalMusicWebsitePurchaseModalAssets",""):d;c.guardFatal?c.guardFatal(e)(c,window):c.execute(function(){e(c,window)})})(function(e,d,l){(function(){e.when("jQuery","a-modal","dmusic_desktop").register("dmusic_webstore_purchase_modal",function(c,e,f){function v(a,b){a&&c.ajax({url:"/gp/dmusic/purchase/utility/promoHelper.html",data:{operation:"redeemCode",code:a},type:"POST",dataType:"json",cache:!1,success:function(a){b(a.success)},
error:function(a){b("0")}})}function q(){var a=!1;if(0<c(".a-lt-ie10").length)return!1;var b=navigator.userAgent,g=-1!==b.indexOf("MSIE"),d=-1!==b.indexOf("Trident"),b=-1!==b.indexOf("Edge");if(g||d||b)return!1;try{a=f.isClientAvailable()}catch(x){}return a}function m(a){a.skipReview||(a.skipReview=0);a.orderId&&"0"!==a.orderId||(a.orderId=0);a.acceptsTOU||(a.acceptsTOU=0);a.acceptsCRD||(a.acceptsCRD=0);a.isError=0;if(a.skipReview&&a.ASIN&&!a.orderId)if(a.orderCreated){var b="dmusic_modal_"+a.ASIN.toString()+
"\x3d([^;]*)",b=new RegExp(b);if(b=document.cookie.match(b))a.orderId=b[1];if(0===a.orderId){a.orderId=0;setTimeout(function(){m(a)},500);return}}else{w(a);return}"-1"!==a.orderId||a.showFixupFlow||(a.isError=1);b={url:"https://"+d.location.host+"/gp/dmusic/modalPurchasing/utility/modal-purchase-controller.html",data:{ASIN:a.ASIN.toString(),orderId:a.orderId.toString(),skipReview:a.skipReview.toString(),acceptsTOU:a.acceptsTOU.toString(),acceptsCRD:a.acceptsCRD.toString(),isError:a.isError,csrfToken:a.csrfToken?
a.csrfToken.toString():"",libraryAsinList:a.libraryAsinList?a.libraryAsinList.toString():"",prereleasedTracksOrderId:a.prereleasedTracksOrderId?a.prereleasedTracksOrderId.toString():"",orderTotal:a.orderTotal?a.orderTotal:"",errorCode:a.errorCode?a.errorCode:"",isPreorder:a.isPreorder?a.isPreorder:0,paymentPlanId:a.paymentPlanId?a.paymentPlanId:"",showFixupFlow:a.showFixupFlow?a.showFixupFlow:0,paymentMethodId:a.paymentMethodId?a.paymentMethodId:"",authenticationSourceId:a.authenticationSourceId?
a.authenticationSourceId:""},type:"POST",dataType:"json",cache:!1,success:function(a){1===a.requiresRedirect?d.location=a.modalUrl:n(a.modalUrl)},error:function(a){}};"object"===typeof k&&c.isFunction(k.ajax)?k.ajax(b):c.ajax(b)}function w(a){if(a&&a.ASIN&&"function"===typeof a.ASIN.toString){r(a);var b=location.search.match(/tag=([^&]+)/),b={url:"https://"+d.location.host+"/gp/dmusic/modalPurchasing/utility/order-constructor.html",data:{ASIN:a.ASIN.toString(),acceptsTOU:a.acceptsTOU&&"function"===
typeof a.acceptsTOU.toString?a.acceptsTOU.toString():"",csrfToken:a.csrfToken&&"function"===typeof a.csrfToken.toString?a.csrfToken.toString():"",associate:b&&2===b.length&&b[1]?b[1]:""},type:"POST",dataType:"json",cache:!1,success:function(b){a.orderCreated=1;a.orderId=b.orderId;a.prereleasedTracksOrderId=b.prereleasedTracksOrderId;a.orderTotal=b.orderTotal;a.errorCode=b.errorCode;a.isPreorder=b.isPreorder;a.paymentPlanId=b.paymentPlanId;a.showFixupFlow=b.showFixupFlow;a.redirectURL=b.redirectURL;
a.paymentMethodId=b.paymentMethodId?b.paymentMethodId:"";a.authenticationSourceId=b.authenticationSourceId?b.authenticationSourceId:"";"pendingFulfillment"===a.errorCode?d.location=a.redirectURL:m(a)},error:function(a){}};"object"===typeof k&&c.isFunction(k.ajax)?k.ajax(b):c.ajax(b)}}function r(a){if(a&&a.ASIN){var b=location.host.match(/amazon[^\/]*/);document.cookie="dmusic_modal_"+a.ASIN.toString()+"\x3d0;path\x3d/;domain\x3d"+b+";"}}function t(){try{return new d.XMLHttpRequest}catch(a){}}var h=
{},n=function(a){a={activate:"onclick",closeButton:!1,dataStrategy:"ajax",name:"PurchaseModal",url:a,width:570};p();var b=e.create("\x3cspan\x3e",a);c(document).delegate("#ModalPurchaseCustomClose","click",function(a){b.unlock(20);e.remove(b)});b.lock(20).show()},p=function(){var a=e.get("PurchaseModal");a&&(a.unlock(20),e.remove(a))},u=function(a){n("/gp/dmusic/modalPurchasing/thankYou?ref\x3ddm_tym_rty\x26ASIN\x3d"+a.ASIN.toString()+"\x26orderId\x3d"+a.orderId.toString())};"undefined"!==typeof h&&
h||(h={});if("undefined"===typeof h.DLedOrders||typeof("object"!==h.DLedOrders))h.DLedOrders={};var k={ajax:function(a){if(d.ActiveXObject!==l){var b;if(!(b=/^(get|post|head|put|delete|options)$/i.test(a.type)&&t()))a:{try{b=new d.ActiveXObject("Microsoft.XMLHTTP");break a}catch(c){}b=void 0}a.xhr=b}else a.xhr=t();a.params="";for(var g in a.data)a.data.hasOwnProperty(g)&&(a.params+=g+"\x3d"+a.data[g]+"\x26");a.async=!0;this.send(a)},send:function(a){var b=a.xhr;b.open(a.type,a.url,a.async);b.setRequestHeader("Content-type",
"application/x-www-form-urlencoded");b.withCredentials=!0;try{b.send(a.params||null)}catch(d){}var g=a.success,e=function(){var d;if(e&&4===b.readyState){e=l;b.onreadystatechange=function(){};var f="";d=b.status;"string"===typeof b.responseText&&(f=b.responseText,d||!a.isLocal||a.crossDomain?1223===d&&(d=204):d=f?200:404,200===d&&f&&c.isFunction(g)&&("json"===a.dataType?(d=eval("("+f+")"),g(d)):g(f)))}};4===b.readyState?setTimeout(e):b.onreadystatechange=e}};return{callModal:n,closeModal:p,togglePromoWidgets:function(){var a=
c("#ModalPurchasePromoBox");0<a.length&&(a.hasClass("Visible")?a.removeClass("Visible"):a.addClass("Visible"))},launchOrGetAppForiPad:function(){var a=(new Date).getTime();setTimeout(function(){4E3>(new Date).getTime()-a&&(d.location="https://itunes.apple.com/app/amazon-cloud-player/id510855668")},2E3);d.location="amznmp3://mp3/library/cirrus/playlists?sync\x3dtrue\x26source\x3dstore"},setupPromoEntryOn:function(a){a.applyButtonId&&a.entryFieldId&&c(a.applyButtonId).click(function(){var b=c(a.entryFieldId).val();
a.errorFieldId&&c(a.errorFieldId).hide();a.successFieldId&&c(a.successFieldId).hide();v(b,function(b){1===b?(c(a.entryFieldId).val(""),a.successFieldId&&c(a.successFieldId).show()):a.errorFieldId&&c(a.errorFieldId).show()})})},setOneClick:function(){var a=c("#setOneClickCheck").attr("checked");c.ajax({url:"/gp/dmusic/utility/set-one-click.html",data:{setOneClick:!0===a?0:1},type:"POST",dataType:"json",cache:!1,success:function(a){},error:function(a){}})},reopenThankYouModal:u,handleDownloadButtonClick:function(a){a.htmlId||
(a.htmlId="DownloadMP3Button");a.orderId&&(h.DLedOrders[a.orderId]=1);a.singleTrack=a.singleTrack?!0:!1;"string"===typeof a.ASIN&&(a.asins=a.ASIN.match(/\w{10}/g).join());a.backClickHandler||(a.backClickHandler=u);a.modalPurchaseCallback||(a.modalPurchaseCallback=p);if("object"===typeof f)a.app=f.APP.STORE,f.processDownload(a);else return a=c("#"+a.htmlId),d.location=a.href,!1},handlePlayButtonClick:function(a){if(a.orderId&&a.customerId&&"object"===typeof f&&"function"===typeof f.processPlayback)return f.processPlayback(a)},
setupModalPurchaseOn:function(a){if(!a.htmlId||!a.ASIN)return!0;c("#"+a.htmlId.toString()).click(function(){if(!q())return!0;m(a);return!1})},drivePurchase:m,clearOrder:r,updateDetailPage:function(a){var b=null;a.forEach(function(a){var d=c("#dmusic_tracklist_player_buy_button_"+a),e=c("#dmusic_tracklist_play_"+a);0<d.length&&0<e.length&&(d.addClass("aok-hidden"),e.removeClass("aok-hidden"));c("#dmusic_tracklist_player_cart_options_section_"+a).addClass("aok-hidden");0<c("#"+a+".DigitalBuyButtonSection").length&&
(b=a)});if(b){a=c("#dmusic_buy_box");var d=c("#dmusic_library_section");if(0<a.length&&0<d.length){var e=c("#dmusic_library_button_box .robinAddButton."+b).not(".CloudPlayerDirectLink"),f=c("#PrimeUpsellInstruction"),h=c("#dmusic_library_button_box .PrimeMessage"),k=c("#dmusic_library_button_box .robinPlayButton."+b),l=c("#ListenNowButton"),m=c("#UpgradeNowButton");e.addClass("aok-hidden");f.addClass("aok-hidden");h.addClass("aok-hidden");k.removeClass("aok-hidden");l.removeClass("aok-hidden");0<
m.length&&m.addClass("aok-hidden");a.addClass("aok-hidden");d.removeClass("aok-hidden")}a=c("span[id^\x3ddmusic_tracklist_prime_add_]");d=c("span[id^\x3ddmusic_tracklist_player_buy_button_]");e=c("span[id^\x3ddmusic_tracklist_play_]");f=c("div[id^\x3ddmusic_tracklist_player_cart_options_section_]");a.addClass("aok-hidden");d.addClass("aok-hidden");e.removeClass("aok-hidden");f.addClass("aok-hidden")}},supportPurchaseModal:q}})})()});