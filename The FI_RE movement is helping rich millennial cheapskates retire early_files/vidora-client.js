/*! vidora-client 1.3.2 03-18-2019 */
!function(a,b,c){function d(a){Ra.console&&console.log&&console.log(a)}function e(a){Ra.console&&console.error&&console.error(a)}function f(a){throw new Error(a)}function g(a,b){return a.forEach(b)}function h(a,b){for(var c in a)b(c)}function i(a,b){return a.map(b)}function j(a){return String(a)}function k(a){return void 0===a}function l(a){return null===a}function m(a){return k(a)||l(a)}function n(a){return"string"==typeof a}function o(a){return""===a}function p(a){return!l(a)&&"object"==typeof a}function q(a){return!m(a)&&a.constructor===Array}function r(a){return"function"==typeof a}function s(a,b){return m(a)?b:a}function t(a,b){var c=s(a,{}),d=s(b,{});for(var e in d)c[e]=d[e];return c}function u(a){var b=s(a,{});return p(b)||f("Options should be an object."),b}function v(a){return JSON.parse(a)}function w(a){return JSON.stringify(a)}function x(a){return encodeURIComponent(a).replace(/!/g,"%21").replace(/\*/g,"%2A").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")}function y(a,b){return a<b?-1:a>b?1:0}function z(a){var b=[];for(var c in a){var d=a[c],e=k(d)?[c]:[c,d];b.push(e)}return b.sort(function(a,b){return y(a,b)}),i(b,function(a){return i(a,x).join("=")}).join("&")}function A(){return(new Date).getTime()}function B(a,b){return a.indexOf(b)>=0}function C(){var a=Ta.userAgent;return B(a,"MSIE ")||B(a,"Trident/")||B(a,"Edge/")}function D(a){var b=new Uint16Array(a);crypto.getRandomValues(b);for(var c=[],d=0;d<b.length;d++)c.push(b[d]);return c}function E(){return Math.random()}function F(){return Math.floor(65536*E())}function G(a){for(var b=[],c=0;c<Ua&&c<a;c++)b.push(65535&(F()^A()));for(;c<a;c++)b.push(F());return b}function H(){return i(Wa(10),function(a){var b=(a>>1).toString(32);return Xa.slice(b.length)+b}).join("")}function I(a){var b="string"==typeof a.setItem;return!m(a)&&!b}function J(a,b,c){try{return a.setItem(b,w(c)),!0}catch(a){return e(a),!1}}function K(a,b){var c=a.getItem(b);return m(c)?null:v(c)}function L(a,b){a.removeItem(b)}function M(a,b){for(var c=0;c<a.length;c++){b(a.key(c))}}function N(){return I(Ya)}function O(a,b){return J(Ya,a,b)}function P(a){return K(Ya,a)}function Q(a){L(Ya,a)}function R(a){M(Ya,a)}function S(a,b,c,d){var e=[];if(e.push(a+"="+encodeURIComponent(b)),c){var f=new Date;f.setTime(f.getTime()+1e3*c);var g="expires="+f.toUTCString();e.push(g)}e.push("path=/"),d&&e.push("domain="+d);var h=e.join("; ");Sa.cookie=h}function T(a){for(var b=Sa.cookie.split("; "),c=0;c<b.length;c++){var d=b[c],e=d.indexOf("=");if(-1!==e){if(d.slice(0,e)===a){var f=d.slice(e+1);return decodeURIComponent(f)}}}return null}function U(){return A()+":"+E()}function V(a){return a+db}function W(a){return 0===a.indexOf(cb)&&-1!==a.indexOf(db)}function X(a){return 0===a.indexOf(cb)&&-1===a.indexOf(db)}function Y(a){var b=V(a),c=0;return setInterval(function(){c+=1,O(b,c)},ab)}function Z(a){return P(a)}function $(a){Q(a),setTimeout(function(){Q(a)},100)}function _(a,b){var c=V(a);b&&clearInterval(b),$(c)}function aa(a){return P(a)}function ba(a,b){O(a,b)}function ca(a){var b=V(a);Q(a),$(b)}function da(a,b,c){var d=cb+U(),e=Y(d);return ba(d,{data:a,guid:c,retry:0}),{key:d,guid:c,clock:e}}function ea(a){return da(a,0,U())}function fa(a){var b=a.key;_(b,a.clock),ca(b)}function ga(a){if(a.length>Za){a.sort();for(var b=a.length-$a,c=0;c<b;c++){ca(a.shift())}}}function ha(a){h(a,function(b){var c=a[b],d=Z(b);(m(d)||d===c)&&(delete a[b],$(b))})}function ia(a,b){var c=[];return g(b,function(b){V(b)in a||c.push(b)}),c}function ja(a,b){var c=[];g(a,function(a){var b=aa(a);if(m(b));else{var d=b.retry+1;if(d<_a){var e=da(b.data,d,b.guid);c.push(e)}}ca(a)}),g(c,function(a){var c=a.key,d=aa(c);b(a,d.data,d.guid)})}function ka(){var a={};return R(function(b){W(b)&&(a[b]=Z(b))}),a}function la(){var a=[];return R(function(b){X(b)&&a.push(b)}),a}function ma(a,b){if(!eb){eb=!0;var c=la(),d=ka();ga(c);var e=function(){ha(d),ja(ia(d,c),a),eb=!1,b&&b()};setTimeout(e,bb)}}function na(a,b,c){d("XHR Request Succeded: "+c.url)}function oa(a,b,c){e("XHR Request Failed: "+c.url+" "+a)}function pa(a,b,c){e("XHR Timeout: "+c.url)}function qa(a){return a}function ra(a){return a}function sa(a,b,c){var d=new XMLHttpRequest;d.open(a,b.url,c);var e="onSuccess"in b?b.onSuccess:na,f="onError"in b?b.onError:oa,g="onTimeout"in b?b.onTimeout:pa,h="unmarshall"in b?b.unmarshall:qa;return"crossDomainCredentials"in b&&(d.withCredentials=!0===b.crossDomainCredentials),"timeoutMs"in b&&(d.timeout=b.timeoutMs,d.ontimeout=function(){g.call({},b)}),d.onload=function(){d.readyState===fb&&200===d.status?e.call({},h(d.responseText),d.status,b):f.call({},d.statusText,d.status,d.readyState,b)},d.onerror=function(){var a="Unknown Error.";m(d.status)&&m(d.statusText)?a="Unknown Error.":"statusText"in d&&(a=d.statusText),f.call({},a,d.status,d.readyState,b)},d}function ta(a,b){var c=sa(a,b,!0);if("data"in b){var d="marshall"in b?b.marshall:ra;"dataType"in b&&c.setRequestHeader("Content-type",b.dataType),c.send(d(b.data))}else c.send();return c}function ua(a){ta("GET",a)}function va(a){ta("POST",a)}function wa(a,b){delete Ra[hb][b],ib.removeChild(a)}function xa(a){var b="cb_"+A().toString(16)+"_"+E().toString(16),c=Sa.createElement("script");Ra[hb][b]=function(d){wa(c,b),a.onSuccess.call({},d,jb,a)};var d=function(){b in Ra[hb]&&(wa(c,b),a.onError.call({},"jsonp error",kb,0,gb,a))};c.onerror=d,c.onload=d,c.onreadystatechange=function(){"loaded"!==c.readyState&&"complete"!==c.readyState||d()},c.type="text/javascript",c.src=a.url+"&format=jsonp&callback="+encodeURIComponent(b),ib.appendChild(c)}function ya(){return!m(Ta[lb])}function za(a,b){return Ta[lb](a,b)}function Aa(a,b,c){function d(){a(e),e=[]}var e=[],f=setTimeout(function(){},0);return{add:function(a){clearTimeout(f),e.push(a),e.length>=c?d():f=setTimeout(d,b)},flush:function(){clearTimeout(f),d()}}}function Ba(){}function Ca(a,b){if(t(b,sb),b.data.guid=a.guid,b.data.user_agent=window.navigator.userAgent,b.data.url=window.location.href,ya()&&m(b.onSuccess)){za(b.url,b.marshall(b.data))&&xb(a)}else{var c=b.onSuccess||Ba;b.onSuccess=function(){xb(a),c()},va(b)}}function Da(a,b,c){var d=m(c._baseURI)?a._apiHost:c._baseURI,e=t(t({api_key:a.token},c.query),c._params),f=x(a.getUserId()),g=b.replace("%user_id%",f);return d+"/"+a.apiVersion+g+"?"+z(e)}function Ea(a,b,c){var d=u(c),e=Da(a,b,d),f={url:e};t(f,tb),"success"in d&&(f.onSuccess=d.success),"error"in d&&(f.onError=d.error),(C()?xa:ua)(f)}function Fa(a,b){return n(a)?a:b(a)}function Ga(a,b){if(m(a))return a;for(var c={},d=0;d<b.length;d++)b[d]in a&&(c[b[d]]=a[b[d]]);return c}function Ha(a,b,c){var d=u(c),e=t({api_key:a.token},d._params),f=s(d._baseURI,a._analyticsHost),g=f+"/"+a.apiVersion+"/validate?"+z(e),h={url:g,data:{data:b}},i=wb(h);"success"in d&&(h.onSuccess=d.success),Ca(i,h)}function Ia(a,b){var c=i(b,function(a){return a[0]}),d={};b.length>0&&b[0].length>2&&(d=b[0][2]),Ha(a,c,d)}function Ja(a,b,c,d){d.query=Ga(d.query,c),Ea(a,b,d)}function Ka(a,b,c){a in c&&(b[a]=c[a])}function La(a){m(a)?f("Vidora API constructed without any options."):p(a)?"apiKey"in a||f("Vidora API constructed without an API Key"):f("Vidora API should be constructed with an option object.");var b=t({},a);this.token=b.apiKey,this.apiVersion="v1";var c=this;this._queue=Aa(function(a){Ia(c,a)},500,30),this._analyticsHost=qb,this._apiHost=rb,this._sendMode=ub,this._build=Qa,this._userId=null,yb(Ca)}function Ma(a){a.call({},Hb,Ib)}function Na(a){var b=a[0],c=a.slice(1);b in Hb||f("Invalid api call '"+b+"'"),Hb[b].apply(Hb,c)}function Oa(a){q(a)?Na(a):r(a)?Ma(a):f("typeof call item '"+typeof a+"' not supported.")}function Pa(a,b,c){if(a[c]&&!0===a[c]._init)return void e(Fb+" included twice!");Ra=a,Sa=b;var d=a[c];c in a||(a[c]={}),a[c]._init=!0,a[c].push=Na,a[c].ready=Ma,d&&(d.ready=Ma,d.push=Na,g(d._q,Oa),d=null)}var Qa={version:"1.3.2",rev:"211c07fa5960a71e7bed92b383824d22b6ccb0a2"},Ra=window,Sa=document,Ta=navigator,Ua=1,Va=!k(Ra.Uint16Array)&&!k(Ra.crypto),Wa=Va?D:G,Xa="000",Ya=(Ra.sessionStorage,Ra.localStorage),Za=50,$a=Za,_a=3,ab=5,bb=3*ab,cb="vidoraRequest:",db=".clock",eb=!1,fb=4,gb=2,hb="_vidora_jsonp";Ra[hb]=Ra[hb]||{};var ib=Sa.head||Sa.body||Sa,jb=-200,kb=-400,lb="sendBeacon",mb=document.currentScript||document.scripts[document.scripts.length-1],nb=mb&&mb.src||"",ob=nb.match(/:(\/\/[^\/?#]+)(?:[\/?#]|$)/i),pb=ob&&ob[1]||"//alloy.vidora.com",qb="https:"+pb,rb=pb,sb={marshall:w,dataType:"text/plain"},tb={unmarshall:v},ub=0,vb=1,wb=Ba,xb=Ba,yb=Ba;N()&&(wb=ea,xb=fa,yb=ma),La.prototype.config=function(a){var b=u(a);"analyticsHost"in b&&(this._analyticsHost=b.analyticsHost),"apiHost"in b&&(this._apiHost=b.apiHost)},La.prototype.send=function(a,b,c){for(var d=q(b)?b:[b],e=this.getUserId(),g=this.getSessionId(),h=0;h<d.length;h++){var i=d[h],k=u(c),l={type:Fa(a,j),user_id:Fa(e,j),session_id:Fa(g,j)};m(i)||(l.content_id=Fa(i,j)),t(l,k.params);var n={};Ka("success",n,k),Ka("error",n,k),Ka("timeout",n,k);var o=this._sendMode;switch(("click"===l.type||k.quicksend)&&(o=vb),o){case vb:this._queue.add([l,n,k]),this._queue.flush();break;case ub:this._queue.add([l,n,k]);break;default:f()}}};var zb="/users/%user_id%",Ab="/groups";La.prototype.getItems=function(a){Ja(this,zb+"/recommendations",["category","type","limit"],a)};var Bb=["group_ids"];La.prototype.getGroupRankings=function(a){Ja(this,zb+Ab+"/rankings",Bb,a)},La.prototype._pncItems=function(a){Ea(this,"/pnc"+zb+Ab+"/items",a)};var Cb=5256e3,Db="vidoraUserId";La.prototype.getUUID=function(){var a=T(Db);return l(a)&&(a=H(),S(Db,a,Cb)),a},La.prototype.setUUID=function(a){S(Db,a,Cb)};var Eb=H().slice(0,10);La.prototype.getSessionId=function(){return Eb},La.prototype.setUserId=function(a){this._userId=a},La.prototype.getUserId=function(){return(m(this._userId)||o(this._userId))&&(this._userId=this.getUUID()),this._userId};var Fb="vidora-client",Gb=La,Hb=null,Ib={};Ib._i=function(a,b){var c=t({apiKey:a},b);Hb=new Gb(c),d(Fb+" "+Hb._build.version+" "+Hb._build.rev)},Ib._create=function(a){return new Gb(a)},Pa(a,b,c)}(window,document,"vidora");